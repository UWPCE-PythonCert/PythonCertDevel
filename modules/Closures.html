

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Closures and Function Currying &mdash; PythonCert 4.0 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="PythonCert 4.0 documentation" href="../index.html"/>
        <link rel="up" title="Modules" href="index.html"/>
        <link rel="next" title="Decorators" href="Decorators.html"/>
        <link rel="prev" title="Code Reviews" href="CodeReviews.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> PythonCert
          

          
          </a>

          
            
            
              <div class="version">
                4.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Modules</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="Class_introduction.html">Introductions</a></li>
<li class="toctree-l2"><a class="reference internal" href="IPythonIntroduction.html">IPython Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="Py2vsPy3.html">Python 2 verses Python 3</a></li>
<li class="toctree-l2"><a class="reference internal" href="EnvironmentOverview.html">Introduction to the Environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="Git.html">Intro to Git</a></li>
<li class="toctree-l2"><a class="reference internal" href="GitWorkflow.html">Git Workflow</a></li>
<li class="toctree-l2"><a class="reference internal" href="BasicPython.html">Basic Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="Functions.html">More on Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="Recursion.html">Recursion</a></li>
<li class="toctree-l2"><a class="reference internal" href="Documentation.html">Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="NamingThings.html">Style and Naming</a></li>
<li class="toctree-l2"><a class="reference internal" href="Booleans.html">Boolean Expressions</a></li>
<li class="toctree-l2"><a class="reference internal" href="Modules.html">Code Structure, Modules, and Namespaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="Sequences.html">Python Sequences</a></li>
<li class="toctree-l2"><a class="reference internal" href="Iteration.html">Iteration</a></li>
<li class="toctree-l2"><a class="reference internal" href="Strings.html">Strings</a></li>
<li class="toctree-l2"><a class="reference internal" href="DictsAndSets.html">Dictionaries and Sets</a></li>
<li class="toctree-l2"><a class="reference internal" href="Files.html">File Reading and Writing</a></li>
<li class="toctree-l2"><a class="reference internal" href="Exceptions.html">Exception Handling</a></li>
<li class="toctree-l2"><a class="reference internal" href="Comprehensions.html">Comprehensions</a></li>
<li class="toctree-l2"><a class="reference internal" href="Testing.html">Unit Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="AdvancedArgumentPassing.html">Advanced Argument Passing</a></li>
<li class="toctree-l2"><a class="reference internal" href="DictionaryAsSwitch.html">Using a Dictionary to <code class="docutils literal"><span class="pre">switch</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="MoreOnMutability.html">A bit more on mutability (and copies)</a></li>
<li class="toctree-l2"><a class="reference internal" href="ObjectOrientationOverview.html">Object Orientation Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="PythonClasses.html">Python Classes</a></li>
<li class="toctree-l2"><a class="reference internal" href="SubclassingAndInheritance.html">Subclassing and Inheritance</a></li>
<li class="toctree-l2"><a class="reference internal" href="Properties.html">Properties</a></li>
<li class="toctree-l2"><a class="reference internal" href="StaticAndClassMethods.html">Static and Class Methods</a></li>
<li class="toctree-l2"><a class="reference internal" href="MultipleInheritance.html">Multiple Inheritance</a></li>
<li class="toctree-l2"><a class="reference internal" href="SpecialMethodsAndProtocols.html">Special Methods &amp; Protocols</a></li>
<li class="toctree-l2"><a class="reference internal" href="OO_vs_functional.html">Object Oriented vs Functional Programming</a></li>
<li class="toctree-l2"><a class="reference internal" href="Lambda.html">Anonymous Functions: Lambda</a></li>
<li class="toctree-l2"><a class="reference internal" href="MapFilterReduce.html">Map Filter and Reduce</a></li>
<li class="toctree-l2"><a class="reference internal" href="IPythonParallel.html">IPython Parallel Quickstart</a></li>
<li class="toctree-l2"><a class="reference internal" href="IteratorsAndGenerators.html">Iterators and Generators</a></li>
<li class="toctree-l2"><a class="reference internal" href="Packaging.html">Packages and Packaging</a></li>
<li class="toctree-l2"><a class="reference internal" href="CodeReviews.html">Code Reviews</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Closures and Function Currying</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1">Closures</a></li>
<li class="toctree-l3"><a class="reference internal" href="#scope">Scope</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#global">global</a></li>
<li class="toctree-l4"><a class="reference internal" href="#local">local</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#finding-names">Finding Names</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#the-global-keyword">The global keyword</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#functions-within-functions">Functions within Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id2">Scope</a></li>
<li class="toctree-l3"><a class="reference internal" href="#callbacks">Callbacks</a></li>
<li class="toctree-l3"><a class="reference internal" href="#functools-partial"><code class="docutils literal"><span class="pre">functools.partial</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#real-world-example">Real world Example</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#using-a-curried-function">Using a Curried Function</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="Decorators.html">Decorators</a></li>
<li class="toctree-l2"><a class="reference internal" href="ContextManagers.html">Context Managers</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../exercises/index.html">Exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="../supplemental/index.html">Supplemental Materials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references/index.html">Resources for Specific Python Topics</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">PythonCert</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Modules</a> &raquo;</li>
        
      <li>Closures and Function Currying</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/modules/Closures.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="closures-and-function-currying">
<span id="closures"></span><h1>Closures and Function Currying<a class="headerlink" href="#closures-and-function-currying" title="Permalink to this headline">¶</a></h1>
<p>Defining specialized functions on the fly.</p>
<div class="section" id="id1">
<h2>Closures<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>“Closures” is a cool CS terms for what is really just defining functions on the fly. You can find a “proper” definition here:</p>
<p><a class="reference external" href="https://en.wikipedia.org/wiki/Closure_(computer_programming)">Closures on Wikipedia</a></p>
<p>But I even have trouble following that, so we’ll look at real world examples to get the idea – it’s actually pretty logical.</p>
</div>
<div class="section" id="scope">
<h2>Scope<a class="headerlink" href="#scope" title="Permalink to this headline">¶</a></h2>
<p>In order to get a handle in this, it’s important to understand variable scoping rules in Python.</p>
<p>“Scope” is the word for where in the names in your code are accessible. Another word for a scope is namespace.</p>
<div class="section" id="global">
<h3>global<a class="headerlink" href="#global" title="Permalink to this headline">¶</a></h3>
<p>The simplest is the global scope. This is the where all the names defined right in your code file are (or in the interpreter).</p>
<p>You can get the global namespace with the <code class="docutils literal"><span class="pre">globals()</span></code> function, but …</p>
<p>The Python interpreter defines a handful of names when it starts up, and iPython defines a whole bunch more.  Most of those start with an underscore, so you can filter them out for a more reasonable result:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">print_globals</span><span class="p">():</span>
    <span class="n">ipy_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;In&#39;</span><span class="p">,</span> <span class="s1">&#39;Out&#39;</span><span class="p">,</span> <span class="s1">&#39;get_ipython&#39;</span><span class="p">,</span> <span class="s1">&#39;exit&#39;</span><span class="p">,</span> <span class="s1">&#39;quit&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">globals</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">ipy_names</span><span class="p">):</span>
            <span class="k">print</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</pre></div>
</div>
<p>And run that in a raw interpreter:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [3]: </span>    <span class="k">def</span> <span class="nf">print_globals</span><span class="p">():</span>
<span class="gp">   ...: </span>        <span class="n">ipy_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;In&#39;</span><span class="p">,</span> <span class="s1">&#39;Out&#39;</span><span class="p">,</span> <span class="s1">&#39;get_ipython&#39;</span><span class="p">,</span> <span class="s1">&#39;exit&#39;</span><span class="p">,</span> <span class="s1">&#39;quit&#39;</span><span class="p">]</span>
<span class="gp">   ...: </span>        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">globals</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
<span class="gp">   ...: </span>            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">ipy_names</span><span class="p">):</span>
<span class="gp">   ...: </span>                <span class="k">print</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
<span class="gp">   ...:</span>

<span class="gp">In [4]: </span><span class="n">print_globals</span><span class="p">()</span>
<span class="go">print_globals</span>
</pre></div>
</div>
<p>The only name left is “print_globals” itself – created when we defined the function.</p>
<p>If we add a name or two, they show up in the global scope:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [6]: </span><span class="n">x</span> <span class="o">=</span> <span class="mi">5</span>

<span class="gp">In [7]: </span><span class="n">this</span> <span class="o">=</span> <span class="s2">&quot;that&quot;</span>

<span class="gp">In [8]: </span><span class="n">print_globals</span><span class="p">()</span>
<span class="go">print_globals</span>
<span class="go">x</span>
<span class="go">this</span>
</pre></div>
</div>
<p>names are created by assignment, and by <code class="docutils literal"><span class="pre">def</span></code> and <code class="docutils literal"><span class="pre">class</span></code> statements. we already saw a <code class="docutils literal"><span class="pre">def</span></code>.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [11]: </span><span class="k">class</span> <span class="nc">TestClass</span><span class="p">:</span>
<span class="go">    ...:     pass</span>
<span class="go">    ...:</span>

<span class="gp">In [12]: </span><span class="n">print_globals</span><span class="p">()</span>
<span class="go">print_globals</span>
<span class="go">x</span>
<span class="go">this</span>
<span class="go">test</span>
<span class="go">TestClass</span>
</pre></div>
</div>
</div>
<div class="section" id="local">
<h3>local<a class="headerlink" href="#local" title="Permalink to this headline">¶</a></h3>
<p>So that’s the global scope – what creates a new scope?</p>
<p>A new, “local” scope is created by a function or class definition:</p>
<p>And there is a build in function to get the names in the local scope, too, so we can use it to show us the names in a function’s local namespace. There isn’t a lot of cruft in the local namespace, so we don’t need a special function to print it.</p>
<p>Note that <code class="docutils literal"><span class="pre">locals()</span></code> and <code class="docutils literal"><span class="pre">globals()</span></code> returns a dict of the names and the objects they are bound to, so we can print the keys to get the names:</p>
<dl class="docutils">
<dt>In [15]: def test():</dt>
<dd>…:     x = 5
…:     y = 6
…:     print(locals().keys())
…:</dd>
</dl>
<p>In [16]: test()
dict_keys([‘y’, ‘x’])</p>
<p>When a function is called, it creates a clean local namespace.</p>
<p>Similarly a class definition does the same thing:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [18]: </span><span class="k">class</span> <span class="nc">Test</span><span class="p">:</span>
<span class="go">    ...:     this = &quot;that&quot;</span>
<span class="go">    ...:     z = 54</span>
<span class="go">    ...:     def __init__(self):</span>
<span class="go">    ...:         pass</span>
<span class="go">    ...:     print(locals().keys())</span>
<span class="go">    ...:</span>
<span class="go">dict_keys([&#39;__module__&#39;, &#39;__qualname__&#39;, &#39;this&#39;, &#39;z&#39;, &#39;__init__&#39;])</span>
</pre></div>
</div>
<p>Interesting – that print statement ran when the class was defined…</p>
<p>But you see that class attributes are there, as is the <code class="docutils literal"><span class="pre">__init__</span></code> function.</p>
<p>So each function gets a local namespace (or scope), and so does each class. And it follows that each method (function) in the class gets its own namespace as well.</p>
<p>Turns out that this holds true for functions defined within functions also:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [23]: </span><span class="k">def</span> <span class="nf">outer</span><span class="p">():</span>
<span class="go">    ...:     x = 5</span>
<span class="go">    ...:     y = 6</span>
<span class="go">    ...:     def inner():</span>
<span class="go">    ...:         w = 7</span>
<span class="go">    ...:         z = 8</span>
<span class="go">    ...:         print(&quot;inner scope:&quot;, locals().keys())</span>
<span class="go">    ...:     print(&quot;outer scope:&quot;, locals().keys())</span>
<span class="go">    ...:     inner()</span>

<span class="gp">In [24]: </span><span class="n">outer</span><span class="p">()</span>
<span class="go">outer scope: dict_keys([&#39;inner&#39;, &#39;y&#39;, &#39;x&#39;])</span>
<span class="go">inner scope: dict_keys([&#39;z&#39;, &#39;w&#39;])</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="finding-names">
<h2>Finding Names<a class="headerlink" href="#finding-names" title="Permalink to this headline">¶</a></h2>
<p>So there are multiple scopes in play at any point – the local scope, and all the surrounding scopes. When you use a name, python checks in the local scope first, then moves out one by one until it finds the name. So if you define a new name inside a function, it “overrides” the name in any of the outer scopes. But the outer one will be found.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [33]: </span><span class="n">name1</span> <span class="o">=</span> <span class="s2">&quot;this is global&quot;</span>

<span class="gp">In [34]: </span><span class="n">name2</span> <span class="o">=</span> <span class="s2">&quot;this is global&quot;</span>

<span class="gp">In [35]: </span><span class="k">def</span> <span class="nf">outer</span><span class="p">():</span>
<span class="go">    ...:     name2 = &quot;this is in outer&quot;</span>
<span class="go">    ...:     def inner():</span>
<span class="go">    ...:         name3 = &quot;this is in inner&quot;</span>
<span class="go">    ...:         print(name1)</span>
<span class="go">    ...:         print(name2)</span>
<span class="go">    ...:         print(name3)</span>
<span class="go">    ...:     inner()</span>
<span class="go">    ...:</span>

<span class="gp">In [36]: </span><span class="n">outer</span><span class="p">()</span>
<span class="go">this is global</span>
<span class="go">this is in outer</span>
<span class="go">this is in inner</span>
</pre></div>
</div>
<p>Look carefully to see where each of those names came from. All the print statements are in the inner function, so its local scope is seached first, and then the outer function’s scope, and then the global scope. name1 is only defined in the global scope, so that one is found.</p>
<div class="section" id="the-global-keyword">
<h3>The global keyword<a class="headerlink" href="#the-global-keyword" title="Permalink to this headline">¶</a></h3>
<p>global names can be accessed from within functions, but not if that same name is created in the local scope.</p>
</div>
</div>
<div class="section" id="functions-within-functions">
<h2>Functions within Functions<a class="headerlink" href="#functions-within-functions" title="Permalink to this headline">¶</a></h2>
<p>TODO: Preface this topic with basic scope rules, specifically that you can define functions within functions.  – rriehle</p>
<p>and add nonlocal!</p>
</div>
<div class="section" id="id2">
<h2>Scope<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<p>Why do decorators usually have a function inside another function?</p>
<p>Decorators are implemented using closures. Definition of closures from Wikipedia:</p>
<p>Operationally, a closure is a record storing a function together with an environment: a mapping associating each free variable of the function (variables that are used locally, but defined in an enclosing scope) with the value or reference to which the name was bound when the closure was created. A closure—unlike a plain function—allows the function to access those captured variables through the closure’s copies of their values or references, even when the function is invoked outside their scope.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="k">def</span> <span class="nf">start_at</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
   <span class="o">...</span><span class="p">:</span>     <span class="k">def</span> <span class="nf">increment_by</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>
   <span class="o">...</span><span class="p">:</span>     <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
   <span class="o">...</span><span class="p">:</span>     <span class="k">return</span> <span class="n">increment_by</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">closure_1</span> <span class="o">=</span> <span class="n">start_at</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="n">closure_2</span> <span class="o">=</span> <span class="n">start_at</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="n">closure_1</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="mi">5</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="n">start_at</span><span class="p">(</span><span class="mi">2</span><span class="p">)(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="mi">6</span>
</pre></div>
</div>
<p>Let’s make this more explicit:</p>
<p>Example/decorators/play_with_scope.py</p>
<p>nonlocal declaration: allows you to flag a variable as a free variable even if it’s immutable.</p>
</div>
<div class="section" id="callbacks">
<h2>Callbacks<a class="headerlink" href="#callbacks" title="Permalink to this headline">¶</a></h2>
<p>In addition to decorators, closures are also useful for callbacks.</p>
<p>Callbacks are functions handed off to another function, so that they can call the handed off function once they are done running their own code.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="k">def</span> <span class="nf">my_callback</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
    <span class="o">...</span><span class="p">:</span>     <span class="k">print</span><span class="p">(</span><span class="s2">&quot;function my_callback was called with {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="k">def</span> <span class="nf">make_call</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
             <span class="c1"># do some cool stuff here, and then call the callback</span>
    <span class="o">...</span><span class="p">:</span>     <span class="n">func</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="o">...</span><span class="p">:</span>     <span class="n">make_call</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">my_callback</span><span class="p">)</span>

<span class="n">function</span> <span class="n">my_callback</span> <span class="n">was</span> <span class="n">called</span> <span class="k">with</span> <span class="mi">0</span>
<span class="n">function</span> <span class="n">my_callback</span> <span class="n">was</span> <span class="n">called</span> <span class="k">with</span> <span class="mi">1</span>
<span class="n">function</span> <span class="n">my_callback</span> <span class="n">was</span> <span class="n">called</span> <span class="k">with</span> <span class="mi">2</span>
</pre></div>
</div>
<p>So let’s go straight to an example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">counter</span><span class="p">(</span><span class="n">start_at</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="n">count</span> <span class="o">=</span> <span class="p">[</span><span class="n">start_at</span><span class="p">]</span>
    <span class="k">def</span> <span class="nf">incr</span><span class="p">():</span>
        <span class="n">count</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">count</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">incr</span>
</pre></div>
</div>
<p>What’s going on here?</p>
<p>We have stored the <code class="docutils literal"><span class="pre">start_at</span></code> value in a list.</p>
<p>Then defined a function, <code class="docutils literal"><span class="pre">incr</span></code> that adds one to the value in the list, and returns that value.</p>
<p>[ Quiz: why is it: <code class="docutils literal"><span class="pre">count</span> <span class="pre">=</span> <span class="pre">[start_at]</span></code>, rather than just <code class="docutils literal"><span class="pre">count=start_at</span></code> ]</p>
<p>So what type of object do you get when you call <code class="docutils literal"><span class="pre">counter()</span></code>?</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [37]: </span><span class="n">c</span> <span class="o">=</span> <span class="n">counter</span><span class="p">(</span><span class="n">start_at</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

<span class="gp">In [38]: </span><span class="nb">type</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<span class="gh">Out[38]: </span><span class="go">function</span>
</pre></div>
</div>
<p>So we get a function back – makes sense. The <code class="docutils literal"><span class="pre">def</span></code> defines a function, and that function is what’s getting returned.</p>
<p>Being a function, we can, of course, call it:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [39]: </span><span class="n">c</span><span class="p">()</span>
<span class="gh">Out[39]: </span><span class="go">6</span>

<span class="gp">In [40]: </span><span class="n">c</span><span class="p">()</span>
<span class="gh">Out[40]: </span><span class="go">7</span>
</pre></div>
</div>
<p>Each time is it called, it increments the value by one.</p>
<p>But what happens if we call <code class="docutils literal"><span class="pre">counter()</span></code> multiple times?</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [41]: </span><span class="n">c1</span> <span class="o">=</span> <span class="n">counter</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

<span class="gp">In [42]: </span><span class="n">c2</span> <span class="o">=</span> <span class="n">counter</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>

<span class="gp">In [43]: </span><span class="n">c1</span><span class="p">()</span>
<span class="gh">Out[43]: </span><span class="go">6</span>

<span class="gp">In [44]: </span><span class="n">c2</span><span class="p">()</span>
<span class="gh">Out[44]: </span><span class="go">11</span>
</pre></div>
</div>
<p>So each time <code class="docutils literal"><span class="pre">counter()</span></code> is called, a new function is created. And that function has its own copy of the <code class="docutils literal"><span class="pre">count</span></code> object. This is what makes in a “closure” – it carries with it the scope in which is was created.</p>
<p>The returned <code class="docutils literal"><span class="pre">incr</span></code> function is a “curried” function – a function with some parameters pre-specified.</p>
<p>“Currying” is a special case of closures:</p>
<p><a class="reference external" href="https://en.wikipedia.org/wiki/Currying">Currying on Wikipedia</a></p>
</div>
<div class="section" id="functools-partial">
<h2><code class="docutils literal"><span class="pre">functools.partial</span></code><a class="headerlink" href="#functools-partial" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal"><span class="pre">functools</span></code> module in the standard library provides utilities for working with functions:</p>
<p><a class="reference external" href="https://docs.python.org/3.5/library/functools.html">https://docs.python.org/3.5/library/functools.html</a></p>
<p>Creating a curried function turns out to be common enough that the <code class="docutils literal"><span class="pre">functools.partial</span></code> function provides an optimized way to do it:</p>
<p>What functools.partial does is:</p>
<blockquote>
<div><ul class="simple">
<li>Makes a new version of a function with one or more arguments already filled in.</li>
<li>The new version of a function documents itself.</li>
</ul>
</div></blockquote>
<p>Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">power</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">exponent</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;returns based raised to the give exponent&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">base</span> <span class="o">**</span> <span class="n">exponent</span>
</pre></div>
</div>
<p>Simple enough. but what if we wanted a specialized <code class="docutils literal"><span class="pre">square</span></code> and <code class="docutils literal"><span class="pre">cube</span></code> function?</p>
<p>We can use <code class="docutils literal"><span class="pre">functools.partial</span></code> to <em>partially</em> evaluate the function, giving us a specialized version:</p>
<p>square = partial(power, exponent=2)
cube = partial(power, exponent=3)</p>
</div>
<div class="section" id="real-world-example">
<h2>Real world Example<a class="headerlink" href="#real-world-example" title="Permalink to this headline">¶</a></h2>
<p>I was writing some code to compute the concentration of a contaminant in a river, as it was reduced exponential decay, defined by a half-life:</p>
<p><a class="reference external" href="https://en.wikipedia.org/wiki/Half-life">https://en.wikipedia.org/wiki/Half-life</a></p>
<p>So I wanted a function that would compute how much the concentration would reduces as a function of time – that is:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">scale</span><span class="p">(</span><span class="n">time</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">scale_factor</span>
</pre></div>
</div>
<p>The trick is, that how much the concentration would be reduced depends on teh half life. And for a given material, and given flow conditions in teh river, that half life is pre-determined as:</p>
<p>scale = 0.5 ** (time / (half_life))</p>
<p>So to compute the scale, I could pass that half-life in each time I called the function:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">scale</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">half_life</span><span class="p">):</span>
    <span class="k">return</span> <span class="mf">0.5</span> <span class="o">**</span> <span class="p">(</span><span class="n">time</span> <span class="o">/</span> <span class="p">(</span><span class="n">half_life</span><span class="p">))</span>
</pre></div>
</div>
<p>But this is a bit klunky – I need to keep passing that half_life around, even though it isn’t changing. And there are places, like <code class="docutils literal"><span class="pre">map</span></code> that require a function that takes only one argument!</p>
<p>What if I could create a function, on the fly, that had a particular half-life “baked in”?</p>
<p><em>Enter Currying</em> – Currying is a technique where you reduce the number of parameters that function takes, creating a specialized function with one or more of the original parameters set to a particular value. Here is that technique, applied to the half-life decay problem:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_scale_fun</span><span class="p">(</span><span class="n">half_life</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">half_life</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
        <span class="k">return</span> <span class="mf">0.5</span> <span class="o">**</span> <span class="p">(</span><span class="n">time</span> <span class="o">/</span> <span class="n">half_life</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">half_life</span>
</pre></div>
</div>
<p><strong>NOTE:</strong> This is simple enough to use a lambda for a bit more compact code:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_scale_fun</span><span class="p">(</span><span class="n">half_life</span><span class="p">):</span>
    <span class="k">return</span> <span class="k">lambda</span> <span class="n">time</span><span class="p">:</span> <span class="mf">0.5</span> <span class="o">**</span> <span class="p">(</span><span class="n">time</span> <span class="o">/</span> <span class="n">half_life</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="using-a-curried-function">
<h3>Using a Curried Function<a class="headerlink" href="#using-a-curried-function" title="Permalink to this headline">¶</a></h3>
<p>Create a scale function with a half-life or one hour:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [8]: </span><span class="n">scale</span> <span class="o">=</span> <span class="n">get_scale_fun</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="gp">In [9]: </span><span class="p">[</span><span class="n">scale</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">7</span><span class="p">)]</span>
<span class="gh">Out[9]: </span><span class="go">[1.0, 0.5, 0.25, 0.125, 0.0625, 0.03125, 0.015625]</span>
</pre></div>
</div>
<p>The value is reduced by half every hour.</p>
<p>Now create one with a half life of 2 hours:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [10]: </span><span class="n">scale</span> <span class="o">=</span> <span class="n">get_scale_fun</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

<span class="gp">In [11]: </span><span class="p">[</span><span class="n">scale</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">7</span><span class="p">)]</span>
<span class="gh">Out[11]:</span>
<span class="go">[1.0,</span>
<span class="go"> 0.7071067811865476,</span>
<span class="go"> 0.5,</span>
<span class="go"> 0.3535533905932738,</span>
<span class="go"> 0.25,</span>
<span class="go"> 0.1767766952966369,</span>
<span class="go"> 0.125]</span>
</pre></div>
</div>
<p>And the value is reduced by half every two hours…</p>
<p>And it can be used with <code class="docutils literal"><span class="pre">map</span></code>, too:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [13]: </span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">scale</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">7</span><span class="p">)))</span>
<span class="gh">Out[13]:</span>
<span class="go">[1.0,</span>
<span class="go"> 0.7071067811865476,</span>
<span class="go"> 0.5,</span>
<span class="go"> 0.3535533905932738,</span>
<span class="go"> 0.25,</span>
<span class="go"> 0.1767766952966369,</span>
<span class="go"> 0.125]</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="Decorators.html" class="btn btn-neutral float-right" title="Decorators" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="CodeReviews.html" class="btn btn-neutral" title="Code Reviews" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, University of Washington, Christopher Barker, Brian Dorsey, Cris Ewing, Christy Heaton, Jon Jacky, Maria McKinley, Rick Riehle, Joseph Schilz. Creative Commons Attribution-ShareAlike 3.0 license.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'4.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>